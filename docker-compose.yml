version: '3.8'

services:
  flask-api:
    build: ./flask-api
    container_name: nahb-flask-api
    ports:
      - "5000:5000"
    environment:
      - FLASK_APP=run.py
      - FLASK_ENV=development
      - SECRET_KEY=your-secret-key-2024
      - API_KEY=your-secret-api-key-2024
    volumes:
      - ./flask-api/instance:/app/instance
    networks:
      - nahb-network
    command: python run.py

  django-app:
    build: ./django-app
    container_name: nahb-django-app
    ports:
      - "8000:8000"
    environment:
      - SECRET_KEY=your-django-secret-key-2024
      - FLASK_API_URL=http://flask-api:5000
      - FLASK_API_KEY=your-secret-api-key-2024
    depends_on:
      - flask-api
    volumes:
      - ./django-app:/app
    networks:
      - nahb-network
    command: >
      sh -c "python manage.py migrate &&
             python manage.py runserver 0.0.0.0:8000"

networks:
  nahb-network:
    driver: bridge

volumes:
  flask-data:
  django-data:
